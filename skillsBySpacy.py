import spacy
from collections import Counter
import re

# Загрузка модели
nlp = spacy.load("en_core_web_sm")
# Example text input
job_descriptions = """умение работать ПК;, Ответственность;, Понимание бизнеса;, Пунктуальность;, Умение работать в команде;, Создание графических изображений, используя компьютерную технику;, Ответственность;, Согласование работы системных аналитиков, программистов и других специалистов;, Терпеливость;, Обслуживание локальных сетей и сетевого оборудования;, Установка, наладка, настройка и сопровождение аппаратного и программного обеспечения;, Проведение технического обслуживания компьютеров и периферийного оборудования и их эксплуатация;, Адаптивность;, Ответственность;, Самостоятельность и ответственность;, Дисциплинированность;, Испытание узлов и деталей для промышленного робота;, Ответственность;, Ремонт, настройка и регулировка электронной аппаратуры;, Устранение неполадок и профилактика оборудования;, Поддержание оборудования в рабочем состоянии;, Сервисное обслуживание аппаратного и программного обеспечения;, Самостоятельность и ответственность;, Сотрудничество и взаимодействие;, Дисциплинированность;, Проведение технического обслуживания оборудования;, Исправление неисправностей компьютеров, периферийного оборудования и программного обеспечения;, Адаптивность;, Самостоятельность и ответственность;, Умение работать в команде;, Ремонт, настройка и регулировка электронной аппаратуры;, Монтаж электронного оборудования;, Сборка, установка и ремонт диспетчерского оборудования и телеавтоматики;, Наладка схем и устранение дефектов в устройствах средств защиты и приборах автоматики, телемеханики;, ТО компьютеров и периферийного оборудования и их эксплуатация;, Обнаружение и устранение неисправностей на абонентском телекоммуникационном оборудовании;, Ответственность;, Проектирование программного обеспечения;, Работа в основных программах системы Мiсгоsоft;, Сервисное обслуживание аппаратного и программного обеспечения;, Адаптивность;, Самостоятельность и ответственность;, Автоматизация процессов и поддержка существующих систем аналитики;, Администрирование web-ресурса;, Написание кода на языках программирования;, Проектирование программного обеспечения;, Работа в основных программах системы Мiсгоsоft;, Сервисное обслуживание аппаратного и программного обеспечения;, Составление алгоритма программного кода;, Ответственность;, Стрессоустойчивость;, Обслуживание локальных сетей и сетевого оборудования;, Самостоятельность и ответственность;, Работа в основных программах системы Мiсгоsоft;, Ответственность;, Умение быстро принимать решения;, Аналитическое мышление;, Постановка задач разработчикам;, Сбор и анализ информации;, Разработка технических заданий;, MS SQL;, Анализ данных;, Ответственность;, Умение работать в команде;, Установка ПО серверов;, Работа в программе 1С:Бухгалтерия;, Ответственность;, ответсвеннсоть;, Ответственность;, Кодирование на языках web-программирования;, Отладка программного кода приложения;, Адаптивность;, Ответственность;, Работа в основных программах системы Мiсгоsоft;, Ответственность;, Пунктуальность;, Обслуживание локальных сетей и сетевого оборудования;, Проведение технического обслуживания оборудования;, Установка, наладка, настройка и сопровождение аппаратного и программного обеспечения;, Исправление неисправностей компьютеров, периферийного оборудования и программного обеспечения;, Проведение технического обслуживания компьютеров и периферийного оборудования и их эксплуатация;, Системное мышление;, Автоматизация процессов и поддержка существующих систем аналитики;, Администрирование web-ресурса;, Проектирование программного обеспечения;, Работа в основных программах системы Мiсгоsоft;, Сервисное обслуживание аппаратного и программного обеспечения;, Самостоятельность и ответственность;, Администрирование ПО;, Установка ПО серверов;, Работа в программе 1С:Бухгалтерия;, Ответственность;, Пунктуальность;, Добропорядочность;JavaScript, Git, React, TypeScript, HTML, SQL, Node.js"""

# Обработка текста
doc = nlp(job_descriptions.lower())

# Обновление списка стоп-слов
stop_words = spacy.lang.en.stop_words.STOP_WORDS
stop_words.update(["и", "в", "на", "с", "по", "для", "за", "к", "от", "до", "при", "о", "об", "под", "перед"])

# Извлечение фраз с контекстом
skills_counter = Counter()
for token in doc:
    if token.pos_ in ['VERB', 'NOUN'] and token.text not in stop_words:
        # Поиск зависимых существительных или прилагательных для глаголов
        subtree_span = doc[token.left_edge.i : token.right_edge.i + 1]
        phrase = subtree_span.text.strip()
        if phrase != token.text:
            skills_counter[phrase] += 1
        else:
            # Для существительных проверяем ближайшее окружение
            span = doc[max(token.i - 3, 0) : min(token.i + 4, len(doc))]
            skills_counter[span.text] += 1

# Вывод самых частых навыков с контекстом
most_common_skills = skills_counter.most_common(10)
print(most_common_skills)
